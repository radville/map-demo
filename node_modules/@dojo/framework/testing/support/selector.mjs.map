{"version":3,"file":"selector.mjs","sourceRoot":"","sources":["selector.ts"],"names":[],"mappings":"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","sourcesContent":["import { DNode, DefaultWidgetBaseInterface, WNode, VNode } from '../../widget-core/interfaces';\nimport { decorate, isVNode, isWNode } from '../../widget-core/d';\nimport * as cssSelect from 'css-select-umd';\n\nexport type TestFunction = (elem: DNode<DefaultWidgetBaseInterface>) => boolean;\n\nexport interface DecoratorResult<T> {\n\thasDeferredProperties: boolean;\n\tnodes: T;\n}\n\nexport function decorateNodes(dNode: DNode[]): DecoratorResult<DNode[]>;\nexport function decorateNodes(dNode: DNode): DecoratorResult<DNode>;\nexport function decorateNodes(dNode: DNode | DNode[]): DecoratorResult<DNode | DNode[]>;\nexport function decorateNodes(dNode: any): DecoratorResult<DNode | DNode[]> {\n\tlet hasDeferredProperties = false;\n\tfunction addParent(parent: WNode | VNode): void {\n\t\t(parent.children || []).forEach((child) => {\n\t\t\tif (isVNode(child) || isWNode(child)) {\n\t\t\t\t(child as any).parent = parent;\n\t\t\t}\n\t\t});\n\t\tif (isVNode(parent) && typeof parent.deferredPropertiesCallback === 'function') {\n\t\t\thasDeferredProperties = true;\n\t\t\tparent.properties = { ...parent.properties, ...parent.deferredPropertiesCallback(false) };\n\t\t}\n\t}\n\tconst nodes = decorate(dNode, addParent, (node: DNode): node is WNode | VNode => isWNode(node) || isVNode(node));\n\treturn { hasDeferredProperties, nodes };\n}\n\nexport const parseSelector = (selector: string) => {\n\tconst selectors = selector.split(' ');\n\treturn selectors\n\t\t.map((selector) => {\n\t\t\tconst keySigilIndex = selector.indexOf('@');\n\t\t\tif (keySigilIndex === 0) {\n\t\t\t\treturn `[key=\"${selector.substr(1)}\"]`;\n\t\t\t} else if (keySigilIndex > 0) {\n\t\t\t\tconst key = selector.substring(keySigilIndex + 1);\n\t\t\t\treturn `${selector.slice(0, keySigilIndex)}[key=\"${key}\"]`;\n\t\t\t}\n\t\t\treturn selector;\n\t\t})\n\t\t.join(' ');\n};\n\nexport const adapter: any = {\n\tisTag(elem: DNode) {\n\t\treturn isVNode(elem);\n\t},\n\tgetText(elem: DNode[]) {\n\t\treturn '';\n\t},\n\tremoveSubsets(elements: DNode[]) {\n\t\treturn elements;\n\t},\n\tgetChildren(elem: DNode) {\n\t\treturn isVNode(elem) || isWNode(elem) ? elem.children : [];\n\t},\n\tgetAttributeValue(elem: DNode, name: string) {\n\t\tif (isVNode(elem) || isWNode(elem)) {\n\t\t\tif (name === 'class') {\n\t\t\t\tconst classes = (elem.properties as any).classes;\n\t\t\t\tif (Array.isArray(classes)) {\n\t\t\t\t\treturn classes.join(' ');\n\t\t\t\t}\n\t\t\t\treturn classes;\n\t\t\t}\n\t\t\treturn (elem.properties as any)[name];\n\t\t}\n\t},\n\thasAttrib(elem: DNode, name: string) {\n\t\tif (isVNode(elem) || isWNode(elem)) {\n\t\t\treturn name in elem.properties;\n\t\t}\n\t\treturn false;\n\t},\n\texistsOne(test: TestFunction, elements: DNode[]) {\n\t\treturn elements.some((elem: DNode) => test(elem));\n\t},\n\tgetName(elem: DNode) {\n\t\tif (isVNode(elem)) {\n\t\t\treturn elem.tag;\n\t\t}\n\t},\n\tgetParent(elem: DNode) {\n\t\tif (isVNode(elem) || isWNode(elem)) {\n\t\t\treturn (elem as any).parent;\n\t\t}\n\t},\n\tgetSiblings(elem: DNode) {\n\t\tif (isVNode(elem) || isWNode(elem)) {\n\t\t\tif ((elem as any).parent) {\n\t\t\t\treturn (elem as any).parent.children;\n\t\t\t}\n\t\t\treturn [elem];\n\t\t}\n\t},\n\tfindOne(test: TestFunction, arr: DNode[]): DNode {\n\t\tlet elem = null;\n\t\tfor (let i = 0, l = arr.length; i < l && !elem; i++) {\n\t\t\tif (test(arr[i])) {\n\t\t\t\telem = arr[i];\n\t\t\t} else {\n\t\t\t\tconst children = adapter.getChildren(arr[i]);\n\t\t\t\tif (children && children.length > 0) {\n\t\t\t\t\telem = adapter.findOne(test, children);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn elem;\n\t},\n\tfindAll(test: TestFunction, elements: DNode[]): DNode[] {\n\t\tlet result: DNode[] = [];\n\t\tfor (let i = 0, j = elements.length; i < j; i++) {\n\t\t\tif (test(elements[i])) {\n\t\t\t\tresult.push(elements[i]);\n\t\t\t}\n\t\t\tconst children = adapter.getChildren(elements[i]);\n\t\t\tif (children) {\n\t\t\t\tresult = [...result, ...adapter.findAll(test, children)];\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n};\n\nexport function select(selector: string, nodes: DNode | DNode[]): (WNode | VNode)[] {\n\tnodes = decorateNodes(nodes).nodes;\n\tnodes = Array.isArray(nodes) ? nodes : [nodes];\n\tselector = parseSelector(selector);\n\treturn cssSelect(selector, nodes, { adapter }) as (WNode | VNode)[];\n}\n\nexport default select;\n"]}