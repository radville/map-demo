// COPYRIGHT Â© 2019 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.14/esri/copyright.txt for details.

define(["require","exports","../core/tsSupport/assignHelper","../core/tsSupport/declareExtendsHelper","../core/tsSupport/decorateHelper","../core/tsSupport/generatorHelper","../core/tsSupport/awaiterHelper","../config","../geometry","../request","../core/Error","../core/Evented","../core/Identifiable","../core/Loadable","../core/Logger","../core/urlUtils","../core/accessorSupport/decorators","@dojo/framework/shim/Promise"],function(e,t,r,o,n,a,i,p,l,u,s,c,y,d,f,b,h){var v=0,g=f.getLogger("esri.layers.Layer");return function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.attributionDataUrl=null,e.fullExtent=new l.Extent(-180,-90,180,90,l.SpatialReference.WGS84),e.legendEnabled=!0,e.listMode="show",e.opacity=1,e.parent=null,e.popupEnabled=!0,e.attributionVisible=!0,e.spatialReference=l.SpatialReference.WGS84,e.title=null,e.type=null,e.url=null,e.visible=!0,e}return o(r,t),r.fromArcGISServerUrl=function(t){return i(this,void 0,void 0,function(){var r,o,n;return a(this,function(a){switch(a.label){case 0:return r="string"==typeof t?{url:t}:t,[4,new Promise(function(t,r){e(["./support/arcgisLayers"],t,r)})];case 1:o=a.sent(),a.label=2;case 2:return a.trys.push([2,4,,5]),[4,o.fromUrl(r)];case 3:return[2,a.sent()];case 4:throw n=a.sent(),g.error("#fromArcGISServerUrl({ url: '"+r.url+"'})","Failed to create layer from arcgis server url",n),n;case 5:return[2]}})})},r.fromPortalItem=function(t){return i(this,void 0,void 0,function(){var r,o,n,i,l,u;return a(this,function(a){switch(a.label){case 0:return r="portalItem"in t?t:{portalItem:t},[4,new Promise(function(t,r){e(["../portal/support/portalLayers"],t,r)})];case 1:o=a.sent(),a.label=2;case 2:return a.trys.push([2,4,,5]),[4,o.fromItem(r)];case 3:return[2,a.sent()];case 4:throw n=a.sent(),i=r&&r.portalItem,l=i&&i.id||"unset",u=i&&i.portal&&i.portal.url||p.portalUrl,g.error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+u+"', id: '"+l+"')",n),n;case 5:return[2]}})})},r.prototype.initialize=function(){var e=this;this.when().catch(function(t){f.getLogger(e.declaredClass).error("#load()","Failed to load layer (title: '"+e.title+"', id: '"+e.id+"')",t)})},Object.defineProperty(r.prototype,"hasAttributionData",{get:function(){return null!=this.attributionDataUrl},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"id",{get:function(){return Date.now().toString(16)+"-layer-"+v++},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"parsedUrl",{get:function(){var e=this._get("url");return e?b.urlToObject(e):null},enumerable:!0,configurable:!0}),r.prototype.fetchAttributionData=function(){return i(this,void 0,void 0,function(){var e,t;return a(this,function(r){switch(r.label){case 0:return e=this.attributionDataUrl,this.hasAttributionData&&e?[4,u(e,{query:{f:"json"},responseType:"json"})]:[3,2];case 1:return t=r.sent(),[2,t.data];case 2:throw new s("layer:no-attribution-data","Layer does not have attribution data")}})})},n([h.property({type:String})],r.prototype,"attributionDataUrl",void 0),n([h.property({type:l.Extent})],r.prototype,"fullExtent",void 0),n([h.property({readOnly:!0,dependsOn:["attributionDataUrl"]})],r.prototype,"hasAttributionData",null),n([h.property({type:String})],r.prototype,"id",null),n([h.property({type:Boolean})],r.prototype,"legendEnabled",void 0),n([h.property({type:["show","hide","hide-children"]})],r.prototype,"listMode",void 0),n([h.property({type:Number,range:{min:0,max:1},nonNullable:!0})],r.prototype,"opacity",void 0),n([h.property()],r.prototype,"parent",void 0),n([h.property({readOnly:!0,dependsOn:["url"]})],r.prototype,"parsedUrl",null),n([h.property({type:Boolean})],r.prototype,"popupEnabled",void 0),n([h.property({type:Boolean})],r.prototype,"attributionVisible",void 0),n([h.property({type:l.SpatialReference})],r.prototype,"spatialReference",void 0),n([h.property({type:String})],r.prototype,"title",void 0),n([h.property({type:String,readOnly:!0,json:{read:!1}})],r.prototype,"type",void 0),n([h.property()],r.prototype,"url",void 0),n([h.property({type:Boolean,nonNullable:!0})],r.prototype,"visible",void 0),r=n([h.subclass("esri.layers.Layer")],r)}(h.declared(c.EventedMixin(y.IdentifiableMixin(d))))});