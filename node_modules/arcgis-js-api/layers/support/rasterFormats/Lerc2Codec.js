// COPYRIGHT Â© 2019 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.14/esri/copyright.txt for details.

define([],function(){"use strict";var e={unstuff:function(e,r,t,a,i,n,f,s){var l,o,u,c,h,d=(1<<t)-1,p=0,g=0,m=4*e.length-Math.ceil(t*a/8);if(e[e.length-1]<<=8*m,i)for(l=0;l<a;l++)0===g&&(u=e[p++],g=32),g>=t?(o=u>>>g-t&d,g-=t):(c=t-g,o=(u&d)<<c&d,u=e[p++],g=32-c,o+=u>>>g),r[l]=i[o];else for(h=Math.ceil((s-n)/f),l=0;l<a;l++)0===g&&(u=e[p++],g=32),g>=t?(o=u>>>g-t&d,g-=t):(c=t-g,o=(u&d)<<c&d,u=e[p++],g=32-c,o+=u>>>g),r[l]=o<h?n+o*f:s},unstuffLUT:function(e,r,t,a,i,n){var f,s=(1<<r)-1,l=0,o=0,u=0,c=0,h=0,d=[],p=4*e.length-Math.ceil(r*t/8);e[e.length-1]<<=8*p;var g=Math.ceil((n-a)/i);for(o=0;o<t;o++)0===c&&(f=e[l++],c=32),c>=r?(h=f>>>c-r&s,c-=r):(u=r-c,h=(f&s)<<u&s,f=e[l++],c=32-u,h+=f>>>c),d[o]=h<g?a+h*i:n;return d.unshift(a),d},unstuff2:function(e,r,t,a,i,n,f,s){var l,o,u,c,h=(1<<t)-1,d=0,p=0,g=0;if(i)for(l=0;l<a;l++)0===p&&(u=e[d++],p=32,g=0),p>=t?(o=u>>>g&h,p-=t,g+=t):(c=t-p,o=u>>>g&h,u=e[d++],p=32-c,o|=(u&(1<<c)-1)<<t-c,g=c),r[l]=i[o];else{var m=Math.ceil((s-n)/f);for(l=0;l<a;l++)0===p&&(u=e[d++],p=32,g=0),p>=t?(o=u>>>g&h,p-=t,g+=t):(c=t-p,o=u>>>g&h,u=e[d++],p=32-c,o|=(u&(1<<c)-1)<<t-c,g=c),r[l]=o<m?n+o*f:s}return r},unstuffLUT2:function(e,r,t,a,i,n){var f,s=(1<<r)-1,l=0,o=0,u=0,c=0,h=0,d=0,p=[],g=Math.ceil((n-a)/i);for(o=0;o<t;o++)0===c&&(f=e[l++],c=32,d=0),c>=r?(h=f>>>d&s,c-=r,d+=r):(u=r-c,h=f>>>d&s,f=e[l++],c=32-u,h|=(f&(1<<u)-1)<<r-u,d=u),p[o]=h<g?a+h*i:n;return p.unshift(a),p},originalUnstuff:function(e,r,t,a){var i,n,f,s,l=(1<<t)-1,o=0,u=0,c=4*e.length-Math.ceil(t*a/8);for(e[e.length-1]<<=8*c,i=0;i<a;i++)0===u&&(f=e[o++],u=32),u>=t?(n=f>>>u-t&l,u-=t):(s=t-u,n=(f&l)<<s&l,f=e[o++],u=32-s,n+=f>>>u),r[i]=n;return r},originalUnstuff2:function(e,r,t,a){var i,n,f,s,l=(1<<t)-1,o=0,u=0,c=0;for(i=0;i<a;i++)0===u&&(f=e[o++],u=32,c=0),u>=t?(n=f>>>c&l,u-=t,c+=t):(s=t-u,n=f>>>c&l,f=e[o++],u=32-s,n|=(f&(1<<s)-1)<<t-s,c=s),r[i]=n;return r}},r={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(e){for(var r=65535,t=65535,a=e.length,i=Math.floor(a/2),n=0;i;){var f=i>=359?359:i;i-=f;do{r+=e[n++]<<8,t+=r+=e[n++]}while(--f);r=(65535&r)+(r>>>16),t=(65535&t)+(t>>>16)}return 1&a&&(t+=r+=e[n]<<8),r=(65535&r)+(r>>>16),((t=(65535&t)+(t>>>16))<<16|r)>>>0},readHeaderInfo:function(e,r){var t=r.ptr,a=new Uint8Array(e,t,6),i={};if(i.fileIdentifierString=String.fromCharCode.apply(null,a),0!==i.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+i.fileIdentifierString;t+=6;var n=new DataView(e,t,8),f=n.getInt32(0,!0);i.fileVersion=f,t+=4,f>=3&&(i.checksum=n.getUint32(4,!0),t+=4),n=new DataView(e,t,12),i.height=n.getUint32(0,!0),i.width=n.getUint32(4,!0),t+=8,f>=4?(i.numDims=n.getUint32(8,!0),t+=4):i.numDims=1,n=new DataView(e,t,40),i.numValidPixel=n.getUint32(0,!0),i.microBlockSize=n.getInt32(4,!0),i.blobSize=n.getInt32(8,!0),i.imageType=n.getInt32(12,!0),i.maxZError=n.getFloat64(16,!0),i.zMin=n.getFloat64(24,!0),i.zMax=n.getFloat64(32,!0),t+=40,r.headerInfo=i,r.ptr=t;var s;if(f>=3&&(s=f>=4?52:48,this.computeChecksumFletcher32(new Uint8Array(e,t-s,i.blobSize-14))!==i.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(e,r){var t=r.headerInfo,a=this.getDataTypeArray(t.imageType),i=t.numDims*this.getDataTypeSize(t.imageType),n=this.readSubArray(e,r.ptr,a,i),f=this.readSubArray(e,r.ptr+i,a,i);r.ptr+=2*i;var s,l=!0;for(s=0;s<t.numDims;s++)if(n[s]!==f[s]){l=!1;break}return t.minValues=n,t.maxValues=f,l},readSubArray:function(e,r,t,a){var i;if(t===Uint8Array)i=new Uint8Array(e,r,a);else{var n=new ArrayBuffer(a);new Uint8Array(n).set(new Uint8Array(e,r,a)),i=new t(n)}return i},readMask:function(e,r){var t=r.ptr,a=r.headerInfo,i=a.width*a.height,n=a.numValidPixel,f=new DataView(e,t,4),s={};if(s.numBytes=f.getUint32(0,!0),t+=4,(0===n||i===n)&&0!==s.numBytes)throw"invalid mask";var l,o;if(0===n)l=new Uint8Array(Math.ceil(i/8)),s.bitset=l,o=new Uint8Array(i),r.pixels.resultMask=o,t+=s.numBytes;else if(s.numBytes>0){l=new Uint8Array(Math.ceil(i/8)),f=new DataView(e,t,s.numBytes);var u=f.getInt16(0,!0),c=2,h=0,d=0;do{if(u>0)for(;u--;)l[h++]=f.getUint8(c++);else for(d=f.getUint8(c++),u=-u;u--;)l[h++]=d;u=f.getInt16(c,!0),c+=2}while(c<s.numBytes);if(-32768!==u||h<l.length)throw"Unexpected end of mask RLE encoding";o=new Uint8Array(i);var p=0,g=0;for(g=0;g<i;g++)7&g?(p=l[g>>3],p<<=7&g):p=l[g>>3],128&p&&(o[g]=1);r.pixels.resultMask=o,s.bitset=l,t+=s.numBytes}return r.ptr=t,r.mask=s,!0},readDataOneSweep:function(e,t,a){var i,n=t.ptr,f=t.headerInfo,s=f.numDims,l=f.width*f.height,o=f.imageType,u=f.numValidPixel*r.getDataTypeSize(o)*s,c=t.pixels.resultMask;if(a===Uint8Array)i=new Uint8Array(e,n,u);else{var h=new ArrayBuffer(u);new Uint8Array(h).set(new Uint8Array(e,n,u)),i=new a(h)}if(i.length===l*s)t.pixels.resultPixels=i;else{t.pixels.resultPixels=new a(l*s);var d=0,p=0,g=0,m=0;if(s>1)for(g=0;g<s;g++)for(m=g*l,p=0;p<l;p++)c[p]&&(t.pixels.resultPixels[m+p]=i[d++]);else for(p=0;p<l;p++)c[p]&&(t.pixels.resultPixels[p]=i[d++])}return n+=u,t.ptr=n,!0},readHuffmanTree:function(e,a){var i=this.HUFFMAN_LUT_BITS_MAX,n=new DataView(e,a.ptr,16);if(a.ptr+=16,n.getInt32(0,!0)<2)throw"unsupported Huffman version";var f=n.getInt32(4,!0),s=n.getInt32(8,!0),l=n.getInt32(12,!0);if(s>=l)return!1;var o=new Uint32Array(l-s);r.decodeBits(e,a,o);var u,c,h,d,p=[];for(u=s;u<l;u++)c=u-(u<f?0:f),p[c]={first:o[u-s],second:null};var g=e.byteLength-a.ptr,m=Math.ceil(g/4),w=new ArrayBuffer(4*m);new Uint8Array(w).set(new Uint8Array(e,a.ptr,g));var y,x=new Uint32Array(w),k=0,b=0;for(y=x[0],u=s;u<l;u++)c=u-(u<f?0:f),(d=p[c].first)>0&&(p[c].second=y<<k>>>32-d,32-k>=d?32===(k+=d)&&(k=0,b++,y=x[b]):(k+=d-32,b++,y=x[b],p[c].second|=y>>>32-k));var U=0,v=0,I=new t;for(u=0;u<p.length;u++)void 0!==p[u]&&(U=Math.max(U,p[u].first));v=U>=i?i:U;var M,A,V,D,T,S,B=[];for(u=s;u<l;u++)if(c=u-(u<f?0:f),(d=p[c].first)>0)if(M=[d,c],d<=v)for(A=p[c].second<<v-d,V=1<<v-d,h=0;h<V;h++)B[A|h]=M;else for(A=p[c].second,S=I,D=d-1;D>=0;D--)T=A>>>D&1,T?(S.right||(S.right=new t),S=S.right):(S.left||(S.left=new t),S=S.left),0!==D||S.val||(S.val=M[1]);return{decodeLut:B,numBitsLUTQick:v,numBitsLUT:U,tree:I,stuffedData:x,srcPtr:b,bitPos:k}},readHuffman:function(e,r,t){var a,i,n,f,s,l,o,u,c,h,d=r.headerInfo,p=d.numDims,g=r.headerInfo.height,m=r.headerInfo.width,w=m*g,y=this.readHuffmanTree(e,r),x=y.decodeLut,k=y.tree,b=y.stuffedData,U=y.srcPtr,v=y.bitPos,I=y.numBitsLUTQick,M=y.numBitsLUT,A=0===r.headerInfo.imageType?128:0,V=r.pixels.resultMask,D=0;v>0&&(U++,v=0);var T,S=b[U],B=1===r.encodeMode,P=new t(w*p),z=P;for(T=0;T<d.numDims;T++){if(p>1&&(z=new t(P.buffer,w*T,w),D=0),r.headerInfo.numValidPixel===m*g)for(c=0,o=0;o<g;o++)for(u=0;u<m;u++,c++){if(i=0,f=S<<v>>>32-I,s=f,32-v<I&&(f|=b[U+1]>>>64-v-I,s=f),x[s])i=x[s][1],v+=x[s][0];else for(f=S<<v>>>32-M,s=f,32-v<M&&(f|=b[U+1]>>>64-v-M,s=f),a=k,h=0;h<M;h++)if(l=f>>>M-h-1&1,a=l?a.right:a.left,!a.left&&!a.right){i=a.val,v=v+h+1;break}v>=32&&(v-=32,U++,S=b[U]),n=i-A,B?(n+=u>0?D:o>0?z[c-m]:D,n&=255,z[c]=n,D=n):z[c]=n}else for(c=0,o=0;o<g;o++)for(u=0;u<m;u++,c++)if(V[c]){if(i=0,f=S<<v>>>32-I,s=f,32-v<I&&(f|=b[U+1]>>>64-v-I,s=f),x[s])i=x[s][1],v+=x[s][0];else for(f=S<<v>>>32-M,s=f,32-v<M&&(f|=b[U+1]>>>64-v-M,s=f),a=k,h=0;h<M;h++)if(l=f>>>M-h-1&1,a=l?a.right:a.left,!a.left&&!a.right){i=a.val,v=v+h+1;break}v>=32&&(v-=32,U++,S=b[U]),n=i-A,B?(u>0&&V[c-1]?n+=D:o>0&&V[c-m]?n+=z[c-m]:n+=D,n&=255,z[c]=n,D=n):z[c]=n}r.ptr=r.ptr+4*(U+1)+(v>0?4:0)}r.pixels.resultPixels=P},decodeBits:function(r,t,a,i,n){var f=t.headerInfo,s=f.fileVersion,l=0,o=r.byteLength-t.ptr>=5?5:r.byteLength-t.ptr,u=new DataView(r,t.ptr,o),c=u.getUint8(0);l++;var h=c>>6,d=0===h?4:3-h,p=(32&c)>0,g=31&c,m=0;if(1===d)m=u.getUint8(l),l++;else if(2===d)m=u.getUint16(l,!0),l+=2;else{if(4!==d)throw"Invalid valid pixel count type";m=u.getUint32(l,!0),l+=4}var w,y,x,k,b,U,v,I,M,A=2*f.maxZError,V=f.numDims>1?f.maxValues[n]:f.zMax;if(p){for(t.counter.lut++,I=u.getUint8(l),g,l++,k=Math.ceil((I-1)*g/8),b=Math.ceil(k/4),y=new ArrayBuffer(4*b),x=new Uint8Array(y),t.ptr+=l,x.set(new Uint8Array(r,t.ptr,k)),v=new Uint32Array(y),t.ptr+=k,M=0;I-1>>>M;)M++;k=Math.ceil(m*M/8),b=Math.ceil(k/4),y=new ArrayBuffer(4*b),x=new Uint8Array(y),x.set(new Uint8Array(r,t.ptr,k)),w=new Uint32Array(y),t.ptr+=k,U=s>=3?e.unstuffLUT2(v,g,I-1,i,A,V):e.unstuffLUT(v,g,I-1,i,A,V),s>=3?e.unstuff2(w,a,M,m,U):e.unstuff(w,a,M,m,U)}else t.counter.bitstuffer++,M=g,t.ptr+=l,M>0&&(k=Math.ceil(m*M/8),b=Math.ceil(k/4),y=new ArrayBuffer(4*b),x=new Uint8Array(y),x.set(new Uint8Array(r,t.ptr,k)),w=new Uint32Array(y),t.ptr+=k,s>=3?null==i?e.originalUnstuff2(w,a,M,m):e.unstuff2(w,a,M,m,!1,i,A,V):null==i?e.originalUnstuff(w,a,M,m):e.unstuff(w,a,M,m,!1,i,A,V))},readTiles:function(e,t,a){var i=t.headerInfo,n=i.width,f=i.height,s=i.microBlockSize,l=i.imageType,o=r.getDataTypeSize(l),u=Math.ceil(n/s),c=Math.ceil(f/s);t.pixels.numBlocksY=c,t.pixels.numBlocksX=u,t.pixels.ptr=0;var h,d,p,g,m,w,y,x,k,b,U,v=0,I=0,M=0,A=0,V=0,D=0,T=0,S=0,B=0,P=0,z=0,L=0,F=0,O=0,C=0,H=new a(s*s),E=f%s||s,_=n%s||s,X=i.numDims,Z=t.pixels.resultMask,R=t.pixels.resultPixels,Y=i.fileVersion,N=Y>=5?14:15,Q=i.zMax;for(M=0;M<c;M++)for(V=M!==c-1?s:E,A=0;A<u;A++)for(D=A!==u-1?s:_,P=M*n*s+A*s,z=n-D,k=0;k<X;k++){if(X>1?(U=R,P=M*n*s+A*s,R=new a(t.pixels.resultPixels.buffer,n*f*k*o,n*f),Q=i.maxValues[k]):U=null,T=e.byteLength-t.ptr,h=new DataView(e,t.ptr,Math.min(10,T)),d={},C=0,S=h.getUint8(0),C++,b=i.fileVersion>=5?4&S:0,B=S>>6&255,(S>>2&N)!==(A*s>>3&N))throw"integrity issue";if(b&&0===k)throw"integrity issue";if((w=3&S)>3)throw t.ptr+=C,"Invalid block encoding ("+w+")";if(2!==w)if(0===w){if(b)throw"integrity issue";if(t.counter.uncompressed++,t.ptr+=C,L=V*D*o,F=e.byteLength-t.ptr,L=L<F?L:F,p=new ArrayBuffer(L%o==0?L:L+o-L%o),g=new Uint8Array(p),g.set(new Uint8Array(e,t.ptr,L)),m=new a(p),O=0,Z)for(v=0;v<V;v++){for(I=0;I<D;I++)Z[P]&&(R[P]=m[O++]),P++;P+=z}else for(v=0;v<V;v++){for(I=0;I<D;I++)R[P++]=m[O++];P+=z}t.ptr+=O*o}else if(y=r.getDataTypeUsed(b&&l<6?5:l,B),x=r.getOnePixel(d,C,y,h),C+=r.getDataTypeSize(y),3===w)if(t.ptr+=C,t.counter.constantoffset++,Z)for(v=0;v<V;v++){for(I=0;I<D;I++)Z[P]&&(R[P]=b?Math.min(Q,U[P]+x):x),P++;P+=z}else for(v=0;v<V;v++){for(I=0;I<D;I++)R[P]=b?Math.min(Q,U[P]+x):x,P++;P+=z}else if(t.ptr+=C,r.decodeBits(e,t,H,x,k),C=0,b)if(Z)for(v=0;v<V;v++){for(I=0;I<D;I++)Z[P]&&(R[P]=H[C++]+U[P]),P++;P+=z}else for(v=0;v<V;v++){for(I=0;I<D;I++)R[P]=H[C++]+U[P],P++;P+=z}else if(Z)for(v=0;v<V;v++){for(I=0;I<D;I++)Z[P]&&(R[P]=H[C++]),P++;P+=z}else for(v=0;v<V;v++){for(I=0;I<D;I++)R[P++]=H[C++];P+=z}else{if(b)if(Z)for(v=0;v<V;v++)for(I=0;I<D;I++)Z[P]&&(R[P]=U[P]),P++;else for(v=0;v<V;v++)for(I=0;I<D;I++)R[P]=U[P],P++;t.counter.constant++,t.ptr+=C}}},formatFileInfo:function(e){return{fileIdentifierString:e.headerInfo.fileIdentifierString,fileVersion:e.headerInfo.fileVersion,imageType:e.headerInfo.imageType,height:e.headerInfo.height,width:e.headerInfo.width,numValidPixel:e.headerInfo.numValidPixel,microBlockSize:e.headerInfo.microBlockSize,blobSize:e.headerInfo.blobSize,maxZError:e.headerInfo.maxZError,pixelType:r.getPixelType(e.headerInfo.imageType),eofOffset:e.eofOffset,mask:e.mask?{numBytes:e.mask.numBytes}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,maxValue:e.headerInfo.zMax,minValue:e.headerInfo.zMin,noDataValue:e.noDataValue}}},constructConstantSurface:function(e){var r=e.headerInfo.zMax,t=e.headerInfo.numDims,a=e.headerInfo.height*e.headerInfo.width,i=0,n=0,f=0,s=e.pixels.resultMask,l=e.pixels.resultPixels;if(s)if(t>1)for(i=0;i<t;i++)for(f=i*a,r=e.headerInfo.maxValues[i],n=0;n<a;n++)s[n]&&(l[f+n]=r);else for(n=0;n<a;n++)s[n]&&(l[n]=r);else if(t>1)for(i=0;i<t;i++)for(f=i*a,r=e.headerInfo.maxValues[i],n=0;n<a;n++)l[f+n]=r;else for(n=0;n<a;n++)l[n]=r},getDataTypeArray:function(e){var r;switch(e){case 0:r=Int8Array;break;case 1:r=Uint8Array;break;case 2:r=Int16Array;break;case 3:r=Uint16Array;break;case 4:r=Int32Array;break;case 5:r=Uint32Array;break;case 6:r=Float32Array;break;case 7:r=Float64Array;break;default:r=Float32Array}return r},getPixelType:function(e){var r;switch(e){case 0:r="S8";break;case 1:r="U8";break;case 2:r="S16";break;case 3:r="U16";break;case 4:r="S32";break;case 5:r="U32";break;case 6:r="F32";break;case 7:r="F64";break;default:r="F32"}return r},isValidPixelValue:function(e,r){if(null==r)return!1;var t;switch(e){case 0:t=r>=-128&&r<=127;break;case 1:t=r>=0&&r<=255;break;case 2:t=r>=-32768&&r<=32767;break;case 3:t=r>=0&&r<=65536;break;case 4:t=r>=-2147483648&&r<=2147483647;break;case 5:t=r>=0&&r<=4294967296;break;case 6:t=r>=-3.4027999387901484e38&&r<=3.4027999387901484e38;break;case 7:t=r>=5e-324&&r<=1.7976931348623157e308;break;default:t=!1}return t},getDataTypeSize:function(e){var r=0;switch(e){case 0:case 1:r=1;break;case 2:case 3:r=2;break;case 4:case 5:case 6:r=4;break;case 7:r=8;break;default:r=e}return r},getDataTypeUsed:function(e,r){var t=e;switch(e){case 2:case 4:t=e-r;break;case 3:case 5:t=e-2*r;break;case 6:t=0===r?e:1===r?2:1;break;case 7:t=0===r?e:e-2*r+1;break;default:t=e}return t},getOnePixel:function(e,r,t,a){var i=0;switch(t){case 0:i=a.getInt8(r);break;case 1:i=a.getUint8(r);break;case 2:i=a.getInt16(r,!0);break;case 3:i=a.getUint16(r,!0);break;case 4:i=a.getInt32(r,!0);break;case 5:i=a.getUInt32(r,!0);break;case 6:i=a.getFloat32(r,!0);break;case 7:i=a.getFloat64(r,!0);break;default:throw"the decoder does not understand this pixel type"}return i}},t=function(e,r,t){this.val=e,this.left=r,this.right=t};return{decode:function(e,t){t=t||{};var a=t.noDataValue,i=0,n={};if(n.ptr=t.inputOffset||0,n.pixels={},r.readHeaderInfo(e,n)){var f=n.headerInfo,s=f.fileVersion,l=r.getDataTypeArray(f.imageType);if(s>5)throw"unsupported lerc version 2."+s;r.readMask(e,n),f.numValidPixel===f.width*f.height||n.pixels.resultMask||(n.pixels.resultMask=t.maskData);var o=f.width*f.height;if(n.pixels.resultPixels=new l(o*f.numDims),n.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0},0!==f.numValidPixel)if(f.zMax===f.zMin)r.constructConstantSurface(n);else if(s>=4&&r.checkMinMaxRanges(e,n))r.constructConstantSurface(n);else{var u=new DataView(e,n.ptr,2),c=u.getUint8(0);if(n.ptr++,c)r.readDataOneSweep(e,n,l);else if(s>1&&f.imageType<=1&&Math.abs(f.maxZError-.5)<1e-5){var h=u.getUint8(1);if(n.ptr++,n.encodeMode=h,h>2||s<4&&h>1)throw"Invalid Huffman flag "+h;h?r.readHuffman(e,n,l):r.readTiles(e,n,l)}else r.readTiles(e,n,l)}n.eofOffset=n.ptr;var d;t.inputOffset?(d=n.headerInfo.blobSize+t.inputOffset-n.ptr,Math.abs(d)>=1&&(n.eofOffset=t.inputOffset+n.headerInfo.blobSize)):(d=n.headerInfo.blobSize-n.ptr,Math.abs(d)>=1&&(n.eofOffset=n.headerInfo.blobSize));var p={width:f.width,height:f.height,pixelData:n.pixels.resultPixels,minValue:f.zMin,maxValue:f.zMax,validPixelCount:f.numValidPixel,dimCount:f.numDims,dimStats:{minValues:f.minValues,maxValues:f.maxValues},maskData:n.pixels.resultMask};if(n.pixels.resultMask&&r.isValidPixelValue(f.imageType,a)){var g=n.pixels.resultMask;for(i=0;i<o;i++)g[i]||(p.pixelData[i]=a);p.noDataValue=a}return n.noDataValue=a,t.returnFileInfo&&(p.fileInfo=r.formatFileInfo(n)),p}},getBandCount:function(e){var t=0,a=0,i={};for(i.ptr=0,i.pixels={};a<e.byteLength-58;)r.readHeaderInfo(e,i),a+=i.headerInfo.blobSize,t++,i.ptr=a;return t}}});