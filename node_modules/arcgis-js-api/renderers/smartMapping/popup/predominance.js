// COPYRIGHT Â© 2019 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.14/esri/copyright.txt for details.

define(["require","exports","../../../core/tsSupport/generatorHelper","../../../core/tsSupport/awaiterHelper","dojo/i18n!../../nls/smartMapping","../../../PopupTemplate","../../../core/Error","../../../intl/substitute","../../../popup/ExpressionInfo","../../../popup/FieldInfo","../statistics/support/predominanceUtils"],function(e,n,t,i,o,r,f,s,a,l,d){function p(e){return e.legendOptions&&e.legendOptions.title?e.legendOptions.title:k}function u(e){return{fieldInfo:new l({fieldName:"expression/predominant-category"}),expressionInfo:new a({name:"predominant-category",title:P,expression:d.getArcadeForPredominantCategoryAlias(e)})}}function m(e){var n=e.map(function(e){return e.fieldName});return{fieldInfo:new l({fieldName:"expression/predominant-value",format:{digitSeparator:!0,places:1}}),expressionInfo:new a({name:"predominant-value",title:M,expression:d.getArcadeForPredominantCategoryValue(n),returnType:"number"})}}function I(e){var n=e.map(function(e){return e.fieldName});return{fieldInfo:new l({fieldName:"expression/predominant-margin",format:{digitSeparator:!0,places:0}}),expressionInfo:new a({name:"predominant-margin",title:E,expression:d.getArcadeForPredominanceMargin(n),returnType:"number"})}}function c(e){var n=e.map(function(e){return e.fieldName});return{fieldInfo:new l({fieldName:"expression/predominant-strength",format:{digitSeparator:!0,places:0}}),expressionInfo:new a({name:"predominant-strength",title:j,expression:d.getArcadeForStrengthOfPredominance(n),returnType:"number"})}}function x(e){return{fieldInfo:new l({fieldName:"expression/predominant-categories-list"}),expressionInfo:new a({name:"predominant-categories-list",title:H,expression:d.getArcadeForOrderedFields(e)})}}function g(e){var n=e.map(function(e){return e.fieldName});return{fieldInfo:new l({fieldName:"expression/predominant-total",format:{digitSeparator:!0,places:0}}),expressionInfo:new a({name:"predominant-total",title:_,expression:d.getArcadeForSumOfFields(n),returnType:"number"})}}function b(e){var n=u(e.fieldInfos),t=new r({expressionInfos:[n.expressionInfo],fieldInfos:[n.fieldInfo],content:s.substitute(o.predominantCategoryContent,{expression:"<b>{"+n.fieldInfo.fieldName+"}</b>"})});return{name:"predominant-category",title:P,value:t}}function v(e){var n=e.fieldInfos,t=u(n),i=m(n),f=new r({expressionInfos:[i.expressionInfo,t.expressionInfo],fieldInfos:[i.fieldInfo,t.fieldInfo],content:s.substitute(o.predominantCategoryValueContent,{expression1:"<b>{"+t.fieldInfo.fieldName+"}</b>",expression2:"<b>{"+i.fieldInfo.fieldName+"}</b>"})});return{name:"predominant-category-value",title:M,value:f}}function y(e){var n=e.fieldInfos,t=u(n),i=m(n),f=I(n),a=new r({expressionInfos:[i.expressionInfo,t.expressionInfo,f.expressionInfo],fieldInfos:[i.fieldInfo,t.fieldInfo,f.fieldInfo],title:s.substitute(o.mostCommon,{expression:"{expression/predominant-category}"}),content:s.substitute(o.predominantCategoryValueMarginContent,{expression1:"<b>{"+t.fieldInfo.fieldName+"}</b>",expression2:"<b>{"+i.fieldInfo.fieldName+"}</b>",expression3:"<b>{"+f.fieldInfo.fieldName+"}</b>"})});return{name:"predominant-category-value-margin",title:E,value:a}}function N(e){var n=e.renderer,t=e.fieldInfos,i=u(t),f=m(t),a=c(t),l=new r({expressionInfos:[f.expressionInfo,i.expressionInfo,a.expressionInfo],fieldInfos:[f.fieldInfo,i.fieldInfo,a.fieldInfo],content:s.substitute(o.predominantCategoryStrengthContent,{title:p(n),expression1:"{"+f.fieldInfo.fieldName+"}",expression2:"<b>{"+i.fieldInfo.fieldName+"}</b>",expression3:"<b>{"+a.fieldInfo.fieldName+"}%</b>"})});return{name:"predominant-category-strength",title:j,value:l}}function h(e){var n=e.renderer,t=e.fieldInfos,i=x(t),o=new r({expressionInfos:[i.expressionInfo],fieldInfo:[i.fieldInfo],title:p(n),content:"{"+i.fieldInfo.fieldName+"}"});return{name:"predominant-categories-list",title:q,value:o}}function w(e){var n=e.fieldInfos,t=u(n),i=x(n),o=new r({expressionInfos:[t.expressionInfo,i.expressionInfo],fieldInfos:[t.fieldInfo,i.fieldInfo],content:[{type:"text",text:'<div><b><font size="3">{'+t.fieldInfo.fieldName+"}</font></b></div>"},{type:"text",text:"{"+i.fieldInfo.fieldName+"}"}]});return{name:"predominant-basic-summary",title:U,value:o}}function C(e){var n=e.renderer,t=e.fieldInfos,i=u(t),f=m(t),a=g(t),l=new r({expressionInfos:[f.expressionInfo,i.expressionInfo,a.expressionInfo],fieldInfos:[f.fieldInfo,i.fieldInfo,a.fieldInfo],content:s.substitute(o.predominantCategoryTotalContent,{title:p(n),expression1:"{"+f.fieldInfo.fieldName+"}",expression2:"<b>{"+i.fieldInfo.fieldName+"}</b>",expression3:"{"+a.fieldInfo.fieldName+"}"})});return{name:"predominant-category-total",title:L,value:l}}function T(e){var n=e.renderer,t=e.fieldInfos,i=u(t),f=m(t),a=c(t),l=g(t),d=new r({expressionInfos:[f.expressionInfo,i.expressionInfo,l.expressionInfo,a.expressionInfo],fieldInfos:[f.fieldInfo,i.fieldInfo,l.fieldInfo,a.fieldInfo],content:s.substitute(o.predominantCategoryTotalStrengthContent,{title:p(n),expression1:"{"+f.fieldInfo.fieldName+"}",expression2:"<b>{"+i.fieldInfo.fieldName+"}</b>",expression3:"<b>{"+a.fieldInfo.fieldName+"}%</b>",expression4:"{"+l.fieldInfo.fieldName+"}"})});return{name:"predominant-category-total-strength",title:W,value:d}}function O(e){var n=e.renderer,t=e.fieldInfos,i=u(t),o=new r({expressionInfos:[i.expressionInfo],fieldInfos:[i.fieldInfo],content:[{type:"text",text:'<div><b><font size="3">{'+i.fieldInfo.fieldName+"}</font></b></div>"},{type:"media",mediaInfos:{type:"pie-chart",title:p(n),value:{fields:t.map(function(e){return e.fieldName})}}}]});return{name:"predominant-category-chart",title:z,value:o}}function S(e,n){var t=e.authoringInfo,i="predominance"===t.type?t.fields:[];if(!i||!i.length)throw new f("predominance-popup:insufficient-info","unable to find input fields in authoringInfo");var o=null;return"popupTemplate"in n&&n.popupTemplate&&(o=n.popupTemplate.fieldInfos),i.map(function(e){var t=n.getField(e),i=new l({fieldName:t.name,label:t.alias});return o&&o.some(function(e){return!(!e||e.fieldName.toLowerCase()!==t.name.toLowerCase())&&(i=e.clone(),!0)}),i})}function F(e){return i(this,void 0,void 0,function(){var n,i,o;return t(this,function(t){switch(t.label){case 0:return n=e.renderer,i=e.layer,[4,i.load()];case 1:return t.sent(),o=S(n,i),[2,{renderer:n,fieldInfos:o}]}})})}function V(e){return i(this,void 0,void 0,function(){var n;return t(this,function(t){switch(t.label){case 0:return[4,F(e)];case 1:return n=t.sent(),[2,[b(n),v(n),y(n),T(n),h(n),w(n),C(n),N(n),O(n)]]}})})}function A(e){return i(this,void 0,void 0,function(){var n,i,o,r,f,s;return t(this,function(t){switch(t.label){case 0:return n=e.renderer,[4,F(e)];case 1:return i=t.sent(),o=n.hasVisualVariables("size",!1),r=n.hasVisualVariables("opacity"),f=b(i),o&&r&&(f=T(i)),o&&!r&&(f=C(i)),!o&&r&&(f=N(i)),[4,V(e)];case 2:return s=t.sent(),[2,{primaryTemplate:f,secondaryTemplates:s.filter(function(e){return e.name!==f.name})}]}})})}Object.defineProperty(n,"__esModule",{value:!0});var P=o.predominantCategory,M=o.predominantCategoryValue,z=o.predominantCategoryWithChart,L=o.predominantCategoryWithTotal,W=o.predominantCategoryWithTotalAndStrength,j=o.strengthOfPredominance,E=o.marginOfVictory,H=o.listOfCategories,_=o.sumOfCategories,q=o.orderedListOfValues,U=o.basicSummary,k=o.competingFields;n.getAllTemplates=V,n.getTemplates=A});