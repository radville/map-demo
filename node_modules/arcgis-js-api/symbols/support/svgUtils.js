// COPYRIGHT Â© 2019 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.14/esri/copyright.txt for details.

define(["require","exports","../../Color","../../core/has","../../core/libs/gl-matrix-2/mat2df32","../../core/libs/gl-matrix-2/math/mat2d","../../widgets/support/widget"],function(t,e,r,i,n,a,o){function l(t){return t.map(function(t){return t.command+" "+t.values.join(" ")}).join(" ").trim()}function h(t,e,r,i){if(t){if("circle"===t.type)return o.tsx("circle",{fill:e,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4",cx:t.cx,cy:t.cy,r:t.r});if("ellipse"===t.type)return o.tsx("ellipse",{fill:e,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4",cx:t.cx,cy:t.cy,rx:t.rx,ry:t.ry});if("rect"===t.type)return o.tsx("rect",{fill:e,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4",x:t.x,y:t.y,width:t.width,height:t.height});if("image"===t.type)return o.tsx("image",{href:t.src,x:t.x,y:t.y,width:t.width,height:t.height,preserveAspectRatio:"none"});if("path"===t.type){var n="string"!=typeof t.path?l(t.path):t.path;return o.tsx("path",{fill:e,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4",d:n})}if("text"===t.type)return o.tsx("text",{fill:e,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4","text-anchor":i.align,"text-decoration":i.decoration,kerning:i.kerning,rotate:i.rotate,"text-rendering":M,"font-style":i.font.style,"font-variant":i.font.variant,"font-weight":i.font.weight,"font-size":i.font.size,"font-family":i.font.family,x:t.x,y:t.y},t.text)}return null}function s(t){var e={fill:"none",pattern:null,linearGradient:null};if(t)if("type"in t&&"pattern"===t.type){var i="patternId-"+ ++N;e.fill="url(#"+i+")",e.pattern={id:i,x:t.x,y:t.y,width:t.width,height:t.height,image:{x:0,y:0,width:t.width,height:t.height,href:t.src}}}else if("type"in t&&"linear"===t.type){var i="linearGradientId-"+ ++I;e.fill="url(#"+i+")",e.linearGradient={id:i,x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,stops:t.colors.map(function(t){return{offset:t.offset,color:t.color&&new r(t.color).toString()}})}}else if(t){var n=new r(t);e.fill=n.toString()}return e}function f(t){var e={color:"none",width:1,cap:"butt",join:"4",dashArray:"none"};if(t&&(null!=t.width&&(e.width=t.width),t.cap&&(e.cap=t.cap),t.join&&(e.join=t.join.toString()),t.color&&(e.color=new r(t.color).toString()),t.style)){var i=null;if(t.style in F&&(i=F[t.style]),Array.isArray(i)){i=i.slice(0);for(var n=0;n<i.length;++n)i[n]*=t.width;if("butt"!==t.cap){for(var n=0;n<i.length;n+=2)i[n]-=t.width,i[n]<1&&(i[n]=1);for(var n=1;n<i.length;n+=2)i[n]+=t.width}i=i.join(",")}e.dashArray=i}return e}function d(t,e){var r={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};return t&&(r.align=t.align,r.decoration=t.decoration,r.kerning=t.kerning?"auto":"0",r.rotate=t.rotated?"90":"0",r.font.style=e.style||"normal",r.font.variant=e.variant||"normal",r.font.weight=e.weight||"normal",r.font.size=e.size&&e.size.toString()||"10pt",r.font.family=e.family||"serif"),r}function c(t){var e=t.pattern,r=t.linearGradient;if(e)return o.tsx("pattern",{id:e.id,patternUnits:"userSpaceOnUse",x:e.x,y:e.y,width:e.width,height:e.height},o.tsx("image",{x:e.image.x,y:e.image.y,width:e.image.width,height:e.image.height,href:e.image.href}));if(r){var i=r.stops.map(function(t,e){return o.tsx("stop",{key:e+"-stop",offset:t.offset,"stop-color":t.color})});return o.tsx("linearGradient",{id:r.id,gradientUnits:"userSpaceOnUse",x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2},i)}return null}function y(t,e,r){return a.translate(t,a.identity(t),[e,r])}function u(t,e,r,i,n){return a.scale(t,a.identity(t),[e,r]),t[4]=t[4]*e-i*e+i,t[5]=t[5]*r-n*r+n,t}function g(t,e,r,i){var n=e%360*Math.PI/180;a.rotate(t,a.identity(t),n);var o=Math.cos(n),l=Math.sin(n),h=t[4],s=t[5];return t[4]=h*o-s*l+i*l-r*o+r,t[5]=s*o+h*l-r*l-i*o+i,t}function x(t,e){T&&"left"in T?(T.left>t&&(T.left=t),T.right<t&&(T.right=t),T.top>e&&(T.top=e),T.bottom<e&&(T.bottom=e)):T={left:t,bottom:e,right:t,top:e}}function p(t){var e,r=t.args,i=r.length;switch(t.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(e=0;e<i;e+=2)x(r[e],r[e+1]);E.x=r[i-2],E.y=r[i-1];break;case"H":for(e=0;e<i;++e)x(r[e],E.y);E.x=r[i-1];break;case"V":for(e=0;e<i;++e)x(E.x,r[e]);E.y=r[i-1];break;case"m":var n=0;"x"in E||(x(E.x=r[0],E.y=r[1]),n=2);for(e=n;e<i;e+=2)x(E.x+=r[e],E.y+=r[e+1]);break;case"l":case"t":for(e=0;e<i;e+=2)x(E.x+=r[e],E.y+=r[e+1]);break;case"h":for(e=0;e<i;++e)x(E.x+=r[e],E.y);break;case"v":for(e=0;e<i;++e)x(E.x,E.y+=r[e]);break;case"c":for(e=0;e<i;e+=6)x(E.x+r[e],E.y+r[e+1]),x(E.x+r[e+2],E.y+r[e+3]),x(E.x+=r[e+4],E.y+=r[e+5]);break;case"s":case"q":for(e=0;e<i;e+=4)x(E.x+r[e],E.y+r[e+1]),x(E.x+=r[e+2],E.y+=r[e+3]);break;case"A":for(e=0;e<i;e+=7)x(r[e+5],r[e+6]);E.x=r[i-2],E.y=r[i-1];break;case"a":for(e=0;e<i;e+=7)x(E.x+=r[e+5],E.y+=r[e+6])}}function m(t,e,r){var i,n=z[t.toLowerCase()];"number"==typeof n&&(n?e.length>=n&&(i={action:t,args:e.slice(0,e.length-e.length%n)},r.push(i),p(i)):(i={action:t,args:[]},r.push(i),p(i)))}function w(t){var e="string"!=typeof t.path?l(t.path):t.path,r=e.match(G),i=[];if(T={},E={},!r)return null;for(var n="",a=[],o=r.length,h=0;h<o;++h){var s=r[h],f=parseFloat(s);isNaN(f)?(n&&m(n,a,i),a=[],n=s):a.push(f)}m(n,a,i);var d={x:0,y:0,width:0,height:0};return T&&"left"in T&&(d.x=T.left,d.y=T.top,d.width=T.right-T.left,d.height=T.bottom-T.top),d}function v(t){var e={x:0,y:0,width:0,height:0};if("circle"===t.type)e.x=t.cx-t.r,e.y=t.cy-t.r,e.width=2*t.r,e.height=2*t.r;else if("ellipse"===t.type)e.x=t.cx-t.rx,e.y=t.cy-t.ry,e.width=2*t.rx,e.height=2*t.ry;else if("image"===t.type||"rect"===t.type)e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height;else if("path"===t.type){var r=w(t);e.x=r.x,e.y=r.y,e.width=r.width,e.height=r.height}return e}function k(t){for(var e={x:0,y:0,width:0,height:0},r=null,i=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,a=0,o=t;a<o.length;a++){var l=o[a];r?(r.x=Math.min(r.x,l.x),r.y=Math.min(r.y,l.y),i=Math.max(i,l.x+l.width),n=Math.max(n,l.y+l.height)):(r=e,r.x=l.x,r.y=l.y,i=l.x+l.width,n=l.y+l.height)}return r&&(r.width=i-r.x,r.height=n-r.y),r}function b(t,e,r,i,o,l){var h=e/2,s=r/2,f=t.width+i,d=t.height+i,c=n.mat2df32.create(),x=n.mat2df32.create(),p=!1;if(o&&0!==f&&0!==d){var m=f/d,w=e>r?e:r,v=1,k=1;isNaN(w)||(m>1?(v=w/f,k=w/m/d):(k=w/d,v=w*m/f)),a.multiply(x,x,u(c,v,k,h,s)),p=!0}var b=t.x+(f-i)/2,j=t.y+(d-i)/2,A=h-b,N=s-j;if(a.multiply(x,x,y(c,A,N)),!p&&(f>e||d>r)){var I=f/e>d/r,S=I?f:d,M=I?e:r,z=M/S;a.multiply(x,x,u(c,z,z,b,j))}return l&&a.multiply(x,x,g(c,l,b,j)),"matrix("+x[0]+","+x[1]+","+x[2]+","+x[3]+","+x[4]+","+x[5]+")"}function j(t,e,r,i){for(var n=[],a=[],l=0,y=t;l<y.length;l++){for(var u=y[l],g=[],x=[],p=0,m=0,w=u;m<w.length;m++){var j=w[m],N=j.shape,I=j.fill,S=j.stroke,M=j.font;p+=S&&S.width||0;var z=s(I),G=f(S),T="text"===N.type?d(N,M):null;n.push(c(z)),g.push(h(N,z.fill,G,T)),x.push(v(N))}var E=b(k(x),e,r,p,i&&i.scale,i&&i.rotation);a.push(o.tsx("g",{transform:E},g))}return o.tsx("svg",{xmlns:A,width:e,height:r},o.tsx("defs",null,n),a)}Object.defineProperty(e,"__esModule",{value:!0});var A="http://www.w3.org/2000/svg",N=0,I=0,S=i("android"),M=i("chrome")||S&&S>=4?"auto":"optimizeLegibility",z={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},G=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g,T={},E={},F={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};e.renderShape=h,e.generateFillAttributes=s,e.generateStrokeAttributes=f,e.generateTextAttributes=d,e.renderDef=c,e.getBoundingBox=v,e.computeBBox=k,e.getTransformMatrix=b,e.renderSVG=j});