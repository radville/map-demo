// COPYRIGHT Â© 2019 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.14/esri/copyright.txt for details.

define(["require","exports","../../../../../core/tsSupport/decorateHelper","../../../../../core/tsSupport/extendsHelper","../../../../../core/maybe","../../../../../core/libs/gl-matrix-2/vec2","../../../../../core/libs/gl-matrix-2/vec2f64","../../../../../core/libs/gl-matrix-2/vec3","../../../../../core/libs/gl-matrix-2/vec3f64","../../../../../core/libs/gl-matrix-2/vec4","../../../../../core/libs/gl-matrix-2/vec4f64","../../../../../geometry/support/coordsUtils","../../../../../geometry/support/spatialReferenceUtils"],function(e,t,r,o,n,i,s,a,p,c,u,l,h){function f(){return new d}function v(e){return n.isSome(e)&&("polygon"===e.type||"polyline"===e.type)}function m(e,t){if(n.isNone(e))return null;var r=y(e);return"polygon"===e.type?new M(e,t,r):new _(e,t,r)}function y(e){return e.hasZ&&e.hasM?new P:e.hasM?new x(1):e.hasZ?new x(0):new g}Object.defineProperty(t,"__esModule",{value:!0});var d=function(){function e(){this.vertices=[],this.edges=[]}return e.prototype.makeVertex=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null);var o={pos:e,unnormalizedPos:e,left:t,right:r,type:"vertex",component:this};return this.vertices.push(o),o},e.prototype.makeEdge=function(e,t){var r={v0:e,v1:t,type:"edge",component:this};return e.right=r,t.left=r,this.edges.push(r),r},e.prototype.removeVertex=function(e){this.vertices.splice(this.vertices.indexOf(e),1),e.left&&this.removeEdge(e.left),e.right&&this.removeEdge(e.right)},e.prototype.removeEdge=function(e){this.edges.splice(this.edges.indexOf(e),1),e.v0.right=null,e.v1.left=null},e}();t.Component=d;var g=function(){function e(){}return e.prototype.createNew=function(){return s.vec2f64.create()},e.prototype.fromArray=function(e){return s.vec2f64.fromValues(e[0],e[1])},e.prototype.toArray=function(e){return[e[0],e[1]]},e.prototype.toPoint=function(e,t){return t.x=e[0],t.y=e[1],t.hasZ=!1,t.hasM=!1,t},e.prototype.lerp=function(e,t,r,o){return i.vec2.lerp(o,e,t,r)},e.prototype.addDelta=function(e,t,r){e[0]+=t,e[1]+=r},e}();t.CoordinateHelper2D=g;var x=function(){function e(e){this.ztype=e}return e.prototype.createNew=function(){return p.vec3f64.create()},e.prototype.fromArray=function(e){return p.vec3f64.fromValues(e[0],e[1],e[2]||0)},e.prototype.toArray=function(e){return[e[0],e[1],e[2]]},e.prototype.toPoint=function(e,t){return t.x=e[0],t.y=e[1],0===this.ztype?(t.z=e[2],t.hasZ=!0,t.hasM=!1):(t.m=e[2],t.hasZ=!1,t.hasM=!0),t},e.prototype.lerp=function(e,t,r,o){return a.vec3.lerp(o,e,t,r)},e.prototype.addDelta=function(e,t,r,o){e[0]+=t,e[1]+=r,0===this.ztype&&(e[2]+=o)},e}();t.CoordinateHelper3D=x;var P=function(){function e(){}return e.prototype.createNew=function(){return u.vec4f64.create()},e.prototype.fromArray=function(e){return u.vec4f64.fromValues(e[0],e[1],e[2]||0,e[3]||0)},e.prototype.toArray=function(e){return[e[0],e[1],e[2],e[3]]},e.prototype.toPoint=function(e,t){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.hasZ=!0,t.hasM=!0,t},e.prototype.lerp=function(e,t,r,o){return c.vec4.lerp(o,e,t,r)},e.prototype.addDelta=function(e,t,r,o){e[0]+=t,e[1]+=r,e[2]+=o},e}();t.CoordinateHelper4D=P;var z=function(){function e(e,t,r){this.geometry=e,this.doUnnormalization=t,this.coordinateHelper=r,this.components=[];var o=h.getInfo(this.geometry.spatialReference);this._tmpMapPoint=r.createNew(),o?(this._spanMin=o.valid[0],this._spanMax=o.valid[1],this._span=this._spanMax-this._spanMin):this.doUnnormalization=!1}return e.prototype.addDelta=function(e,t,r,o){this.coordinateHelper.addDelta(e.pos,t,r,o)},e.prototype.getVertexPositionAsPoint=function(e,t){return this.coordinateHelper.toPoint(e.pos,t),t.spatialReference=this.geometry.spatialReference,t},e.prototype.getEdgePosition=function(e,t,r){return void 0===r&&(r=this.coordinateHelper.createNew()),this.coordinateHelper.lerp(e.v0.unnormalizedPos,e.v1.unnormalizedPos,t,r)},e.prototype.getEdgePositionAsPoint=function(e,t,r){var o=this.getEdgePosition(e,t,this._tmpMapPoint);return this.coordinateHelper.toPoint(o,r),r.spatialReference=this.geometry.spatialReference,r},e.prototype.canRemoveVertex=function(e){return!0},e.prototype.removeVertex=function(e){var t=e.component,r=e.left,o=e.right;return t.removeVertex(e),r&&o?t.makeEdge(r.v0,o.v1):null},e.prototype.splitEdge=function(e,t){var r=e.component,o=r.makeVertex(this.getEdgePosition(e,t)),n=e.v0,i=e.v1;return r.removeEdge(e),r.makeEdge(n,o),r.makeEdge(o,i),o},e}();t.ReshapeHelper=z;var M=function(e){function t(t,r,o){var n=e.call(this,t,r,o)||this;n.geometry=t;for(var i=n.geometry.rings,s=0;s<i.length;++s){for(var a=i[s],p=f(),c=a.length-1,u=0;u<c;++u){var h=o.fromArray(a[u]);p.makeVertex(h)}for(var v=p.vertices.length-1,m=0;m<v;++m){var y=p.vertices[m],d=p.vertices[m+1];p.makeEdge(y,d)}p.makeEdge(p.vertices[p.vertices.length-1],p.vertices[0]),n.doUnnormalization&&l.computeUnnormalizedVertexPositionsOnDateLineCrossing(p.vertices,n._spanMin,n._spanMax,n._span),n.components.push(p)}return n}return o(t,e),t.prototype.canRemoveVertex=function(e){return e.component.vertices.length>3},t.prototype.commit=function(){var e=this,t=[],r=this.coordinateHelper.toArray;return this.components.forEach(function(o){var n=[];e.doUnnormalization&&l.computeUnnormalizedVertexPositionsOnDateLineCrossing(o.vertices,e._spanMin,e._spanMax,e._span);var i=o.vertices[0],s=i;do{n.push(r(i.unnormalizedPos)),i=i.right.v1}while(i&&i!==s);n.push(r(o.vertices[0].unnormalizedPos)),t.push(n)}),this.geometry.rings=t,this.geometry},t}(z),_=function(e){function t(t,r,o){var n=e.call(this,t,r,o)||this;n.geometry=t;for(var i=n.geometry.paths,s=0;s<i.length;++s){for(var a=i[s],p=f(),c=a.length,u=0;u<c;++u){var h=o.fromArray(a[u]);p.makeVertex(h)}for(var v=p.vertices.length-1,m=0;m<v;++m){var y=p.vertices[m],d=p.vertices[m+1];p.makeEdge(y,d)}n.doUnnormalization&&l.computeUnnormalizedVertexPositionsOnDateLineCrossing(p.vertices,n._spanMin,n._spanMax,n._span),n.components.push(p)}return n}return o(t,e),t.prototype.canRemoveVertex=function(e){return e.component.vertices.length>2},t.prototype.commit=function(){var e=this,t=[],r=this.coordinateHelper.toArray;return this.components.forEach(function(o){var n=[];e.doUnnormalization&&l.computeUnnormalizedVertexPositionsOnDateLineCrossing(o.vertices,e._spanMin,e._spanMax,e._span);var i=o.vertices[0],s=i;do{n.push(r(i.unnormalizedPos)),i=i.right?i.right.v1:null}while(i&&i!==s);t.push(n)}),this.geometry.paths=t,this.geometry},t}(z);t.isReshapeGeometry=v,t.createReshapeHelper=m});