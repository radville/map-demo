// COPYRIGHT Â© 2019 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.14/esri/copyright.txt for details.

define(["require","exports","../../../../core/arrayUtils","../../../../core/maybe"],function(n,t,e,i){function r(n,t,e,i){if(x(t,e)){null==n&&(n=m());var r=n.isVisibleBit,l=n.data,a=w(l),u=e/a|0,o=e-a*u,f=O(t),s=f-1,h=s/a|0,c=l,g=c.length*a,v=e<g,d=i===r;if(!v&&d){var p=u+1,b=Math.ceil(1.5*c.length),V=h+1,y=Math.max(p,b);y=Math.min(y,V),l=new Uint32Array(y),l.set(c)}u<l.length&&(l[u]=E(l[u],o,d)),n.data=l}return n}function l(n,t,e,i){if(e<t){null==n&&(n=m());var r=n.isVisibleBit,l=n.data,a=w(l),u=e/a|0,o=e-a*u,f=t-1,s=f/a|0,h=l,c=h.length*a,g=e<c,v=i===r;if(!g&&v){var d=u+1,p=Math.ceil(1.5*h.length),b=s+1,V=Math.max(d,p);V=Math.min(V,b),l=new Uint32Array(V),l.set(h)}u<l.length&&(l[u]=E(l[u],o,v)),n.data=l}return n}function a(n,t){if(null!=n){var e=n.isVisibleBit,i=n.data,r=w(i);return t<i.length*r?U(e,i,t,r):H(n)}return!0}function u(n){var t;if(null==n)t=m(!1);else{t=n,t.isVisibleBit=!0;for(var e=0;e<t.data.length;e++)t.data[e]=0}return t}function o(n){var t;if(null==n);else{t=n,t.isVisibleBit=!1;for(var e=0;e<t.data.length;e++)t.data[e]=0}return t}function f(n,t){var e;if(n)if(C(t))if(0===n.data.length){var i=[],r=[[t[0],I(t[t.length-1])]];e=H(n)?r:i}else{e=[];for(var l=n.isVisibleBit,a=n.data,u=w(a),o=a.length*u,f=O(t),s=!1,h=0;h<o&&h<f;h++){var c=U(l,a,h,u);if(c!==s){var g=t[h];if(c)e.push([g,0]);else{var v=e[e.length-1];v[1]=I(g)}s=c}}var d=H(n);if(f>o&&d&&!s)e.push([t[o],I(t[f])]);else if(s){var v=e[e.length-1],p=d?f:Math.min(f,o);v[1]=I(t[p])}}else{var i=[],r=null;e=H(n)?r:i}else e=null;return e}function s(n){return i.isSome(n.component)?n.component:-1}function h(n,t,e,i){var r;n=n||[];var l={component:t,options:e,id:i};n.push(l);for(var a=s(l),u=n.length-1;u>0&&a<s(n[u-1]);)r=[n[u],n[u-1]],n[u-1]=r[0],n[u]=r[1],--u;return n}function c(n,t){if(!n)return n;var e=n.filter(function(n){return n.id!==t});return 0===e.length?null:e}function g(n,t,e,i,r){a(t,i)&&v(n,e[i],I(e[i+1]),r)}function v(n,t,e,i){var r=n.length>0?n[n.length-1]:null,l=r?r.range[1]:-1,a=r?r.options:null;if(!(l>=t))if(l+1===t&&a===i)r.range[1]=e;else{var u={range:[t,e],options:i};n.push(u)}}function d(n,t,e){if(!t)return null;if(!C(e)){return!n||H(n)?t.map(function(n){return{range:null,options:n.options}}):null}for(var r=e[0],l=I(e[e.length-1]),a=[],u=b(n,e),o=0;o<t.length;++o){var f=t[o].options,s=t[o].component;if(i.isSome(s))g(a,n,e,s,f);else if(u)v(a,r,l,f);else for(var h=0;h<O(e);++h)g(a,n,e,h,f)}return a.length>0?a:null}function p(n,t,e){if(!t)return!1;if(!C(e)){return!!(!n||H(n))&&t.length>0}for(var r=b(n,e),l=0,a=t;l<a.length;l++){var u=a[l].component;if(i.isSome(u))return!0;if(r)return!0;if(O(e)>0)return!0}return!1}function m(n){return void 0===n&&(n=!0),{isVisibleBit:!n,data:new Uint32Array(0)}}function b(n,t){return!M(n,t)}function V(n,t){return!y(n,t)}function y(n,t){return B(n,t,!0)}function M(n,t){return B(n,t,!1)}function B(n,t,e){var i=!1;n=n||P;var r=n.isVisibleBit,l=n.data,a=O(t),u=w(l),o=l.length*u,f=e===r;if(0===l.length||0===a)i=!f;else if(o<a&&!f)i=!0;else{for(var s=_(u),h=_(0),c=0;c<l.length-1;c++)if(i=!f&&l[c]!==s||f&&l[c]!==h)return i;var g=l.length-1,v=(a-1)%u+1,d=_(v);i=!f&&(l[g]&d)!==d||f&&(l[g]&d)!==h}return i}function A(n){return n instanceof Uint32Array?n:new Uint32Array(n)}function x(n,t){return t<O(n)}function C(n){return n.length>0}function H(n){return!n.isVisibleBit}function U(n,t,e,i){var r=e/i|0,l=e-r*i;return S(t[r],l)===n}function w(n){return 8*n.BYTES_PER_ELEMENT}function E(n,t,e){return n&~(1<<t)|(e?1:0)<<t}function S(n,t){return 0!=(n&1<<t)}function _(n){return T[n]}function I(n){return n-1}function O(n){return Math.max(0,n.length-1)}function R(n,t){var i=e.binaryIndexOf(n,t,!0);return i>=0?i:null}Object.defineProperty(t,"__esModule",{value:!0}),t.updateVisibility=r,t.updateVisibilityWithCount=l,t.getVisibility=a,t.hideAllComponents=u,t.unhideAllComponents=o,t.generateVisibleIndexRanges=f,t.addHighlight=h,t.removeHighlight=c,t.generateHighlightedIndexRanges=d,t.hasHighlights=p,t.defaultVisibilities=m,t.isAllVisible=b,t.isAllHidden=V,t.hasVisible=y,t.hasHidden=M;var P=m();t.createOffsets=A,t.hasComponent=x,t.hasComponents=C;for(var T=[],j=0;j<65;j++)T.push(Math.pow(2,j)-1);t.componentCount=O,t.componentFind=R});