// COPYRIGHT Â© 2019 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.14/esri/copyright.txt for details.

define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/mat4","../../../../core/libs/gl-matrix-2/vec2","../../../../core/libs/gl-matrix-2/vec2f64","../../../../core/libs/gl-matrix-2/vec3f64","../../../../core/libs/gl-matrix-2/vec4","../../../../core/libs/gl-matrix-2/vec4f64"],function(t,r,n,a,e,o,i,c,f){function u(t,r){if(!t){r=r||"assert";var n=new Error(r);throw n.stack&&console.log(n.stack),new G(r)}}function s(t,r){t||(r=r||"",console.warn("Verify failed: "+r+"\n"+new Error("verify").stack))}function v(t){return n.clamp(Math.round(32767*t),-32767,32767)}function l(t,r){var n=Math.abs(t[0]),a=Math.abs(t[1]),e=Math.abs(t[2]),o=1/(n+a+e),i=n*o,c=a*o,f=Math.min(t[2]*o,0);r[0]=(t[0]<0?-1:1)*(i-f),r[1]=(t[1]<0?-1:1)*(c-f)}function M(t,r){return void 0===t?r:t}function h(t){return t=Math.floor(t),[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]}function d(t){return"0x"+((n.clamp(Math.round(255*t[0]),0,255)<<16)+(n.clamp(Math.round(255*t[1]),0,255)<<8)+n.clamp(Math.round(255*t[2]),0,255)).toString(16)}function m(t){var r=t.toString(16);return"00000000".substr(0,8-r.length)+r}function x(t,r,n,a,e,o,c,f,u){void 0===u&&(u=i.vec3f64.create());var s=a[c]-n[o],v=a[c+1]-n[o+1],l=a[c+2]-n[o+2],M=e[f]-n[o],h=e[f+1]-n[o+1],d=e[f+2]-n[o+2],m=r[1]*d-h*r[2],x=r[2]*M-d*r[0],g=r[0]*h-M*r[1],p=s*m+v*x+l*g;if(p>-1e-5&&p<1e-5)return!1;var b=1/p,y=t[0]-n[o],O=t[1]-n[o+1],E=t[2]-n[o+2];if(u[1]=b*(y*m+O*x+E*g),u[1]<0||u[1]>1)return!1;var A=O*l-v*E,T=E*s-l*y,N=y*v-s*O;return u[2]=b*(r[0]*A+r[1]*T+r[2]*N),!(u[2]<0||u[1]+u[2]>1)&&(u[0]=b*(M*A+h*T+d*N),!0)}function g(t,r,n,a){var e,o=(n[0]-t[0])/r[0],i=(a[0]-t[0])/r[0];o>i&&(e=o,o=i,i=e);var c=(n[1]-t[1])/r[1],f=(a[1]-t[1])/r[1];if(c>f&&(e=c,c=f,f=e),o>f||c>i)return!1;c>o&&(o=c),f<i&&(i=f);var u=(n[2]-t[2])/r[2],s=(a[2]-t[2])/r[2];return u>s&&(e=u,u=s,s=e),!(o>s||u>i)&&(s<i&&(i=s),!(i<0))}function p(t,r,n,a,e,i){void 0===i&&(i=o.vec2f64.create());var c=(a[e]-n[e])*(r[0]-t[0])-(a[0]-n[0])*(r[e]-t[e]),f=(a[0]-n[0])*(t[e]-n[e])-(a[e]-n[e])*(t[0]-n[0]);if(0===c)return!1;var u=f/c;return i[0]=t[0]+u*(r[0]-t[0]),i[1]=t[e]+u*(r[e]-t[e]),!0}function b(t,r,n,a,e){e||(e=t),F[0]=t[0],F[1]=t[1],F[2]=t[2],F[3]=1,c.vec4.transformMat4(F,F,r),e.length>2&&(e[2]=-F[2]),c.vec4.transformMat4(F,F,n),u(0!==F[3]),e[0]=F[0]/F[3],e[1]=F[1]/F[3],e[2]=F[2]/F[3],e[0]=(.5*e[0]+.5)*a[2]+a[0],e[1]=(.5*e[1]+.5)*a[3]+a[1]}function y(t){for(var r in t)return r}function O(t){return t[y(t)]}function E(t){for(var r in t)return!1;return!0}function A(t,r){return Math.log(t)/Math.log(r)}function T(t,r){t[12]=r[0],t[13]=r[1],t[14]=r[2]}function N(t,r,n,a){t[12]=r,t[13]=n,t[14]=a}function S(t,r){return void 0===r&&(r=i.vec3f64.create()),r[0]=t[12],r[1]=t[13],r[2]=t[14],r}function I(t,r){return t=a.mat4.identity(t),T(t,r),t}function R(t){return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&1===t[15]}function C(t,r,n){return 2*Math.atan(n*Math.tan(.5*t)/r)}function P(t,r,n){return 2*Math.atan(r*Math.tan(.5*t)/n)}function j(t,r,n){return 2*Math.atan(Math.sqrt(r*r+n*n)*Math.tan(.5*t)/r)}function k(t,r,n){return 2*Math.atan(Math.sqrt(r*r+n*n)*Math.tan(.5*t)/n)}function w(t,r,n){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(r*r+n*n))}function U(t,r,n){return 2*Math.atan(n*Math.tan(.5*t)/Math.sqrt(r*r+n*n))}function q(t,r,a){void 0===a&&(a=0);for(var e=n.clamp(t,0,_),o=0;o<4;o++)r[a+o]=Math.floor(256*L(e*V[o]))}function B(t,r){void 0===r&&(r=0);for(var n=0,a=0;a<4;a++)n+=t[r+a]*X[a];return n}function L(t){return t-Math.floor(t)}function D(t,r,n,a,o){var i=t;0===t[11]?(a[0]=2/(r*i[0]),a[1]=2/(n*i[5]),a[2]=(1+i[12])/i[0],a[3]=(1+i[13])/i[5],e.vec2.set(o,0,1)):(a[0]=-2/(r*i[0]),a[1]=-2/(n*i[5]),a[2]=(1-i[8])/i[0],a[3]=(1-i[9])/i[5],e.vec2.set(o,1,0))}Object.defineProperty(r,"__esModule",{value:!0});var F=f.vec4f64.create(),G=function(){function t(t){this.message=t}return t.prototype.toString=function(){return"AssertException: "+this.message},t}();r.AssertException=G,r.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex",TANGENT:"tangent"},r.assert=u,r.verify=s,r.encodeInt16=v,r.encodeNormal=l,r.fallbackIfUndefined=M,r.hex2rgb=h,r.rgb2hex=d,r.dec2hex=m,r.rayTriangle3D=x,r.rayBoxTest=g,r.rayRay2D=p,r.project=b,r.getFirstObjectKey=y,r.getFirstObjectValue=O,r.objectEmpty=E,r.logWithBase=A,r.setMatrixTranslation=T,r.setMatrixTranslation3=N,r.getMatrixTranslation=S,r.createTranslationMatrix=I,r.isTranslationMatrix=R,r.fovx2fovy=C,r.fovy2fovx=P,r.fovx2fovd=j,r.fovy2fovd=k,r.fovd2fovx=w,r.fovd2fovy=U,r.packFloatRGBA=q,r.unpackFloatRGBA=B;var V=[1,256,65536,16777216],X=[1/256,1/65536,1/16777216,1/4294967296],_=B(new Uint8ClampedArray([255,255,255,255]));r.inverseProjectionInfo=D});