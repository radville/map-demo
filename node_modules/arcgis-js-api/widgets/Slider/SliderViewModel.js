// COPYRIGHT Â© 2019 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.14/esri/copyright.txt for details.

define(["require","exports","../../core/tsSupport/declareExtendsHelper","../../core/tsSupport/decorateHelper","../../core/Accessor","../../core/Error","../../core/Logger","../../core/maybe","../../core/accessorSupport/decorators"],function(e,t,r,o,n,i,a,s,u){var l=a.getLogger("esri.widgets.Slider.SliderViewModel");return function(e){function t(t){var r=e.call(this,t)||this;return r.precision=4,r.thumbsConstrained=!0,r}return r(t,e),Object.defineProperty(t.prototype,"labelFormatFunction",{set:function(e){this._set("labelFormatFunction",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputFormatFunction",{set:function(e){this._set("inputFormatFunction",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputParseFunction",{set:function(e){this._set("inputParseFunction",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labels",{get:function(){var e=this,t=this,r=t.max,o=t.min,n=t.values,i=n&&n.length?n.map(function(t,r){return e.getLabelForValue(t,"value",r)}):[];return{max:this.getLabelForValue(r,"max"),min:this.getLabelForValue(o,"min"),values:i}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"max",{set:function(e){this.setMax(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"min",{set:function(e){this.setMin(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){var e=this,t=e.max,r=e.min;return s.isSome(t)&&s.isSome(r)?"ready":"disabled"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"values",{set:function(e){var t=this,r=t.max,o=t.min,n=this.values;n&&e&&n.length===e.length&&n.every(function(t,r){return t===e[r]})||(this._set("values",null),e&&e.length&&(s.isSome(o)&&e.some(function(e){return e<o})&&(this.min=Math.min.apply(Math,e)),s.isSome(r)&&e.some(function(e){return e>r})&&(this.max=Math.max.apply(Math,e))),this._set("values",e))},enumerable:!0,configurable:!0}),t.prototype.toPrecision=function(e){return parseFloat(e.toFixed(this.precision))},t.prototype.defaultLabelFormatFunction=function(e){var t=this,r=t.max,o=t.min,n=t.precision,i=r-o>10?2:n;return parseFloat(e.toFixed(i)).toString()},t.prototype.defaultInputFormatFunction=function(e){return e.toString()},t.prototype.defaultInputParseFunction=function(e){return parseFloat(e)},t.prototype.getBoundsForValueAtIndex=function(e){var t=this,r=t.thumbsConstrained,o=t.max,n=t.min,i=t.values;if(r){var a=e-1,u=e+1;return{min:s.isSome(i[a])?i[a]:n,max:s.isSome(i[u])?i[u]:o}}return{min:n,max:o}},t.prototype.getLabelForValue=function(e,t,r){return s.isSome(e)?this.labelFormatFunction?this.labelFormatFunction(e,t,r):this.defaultLabelFormatFunction(e):null},t.prototype.setMax=function(e){var t=this,r=t.max,o=t.min,n=t.values;if(isNaN(e))return void this._logError("slider:invalid-value","Property 'max' must of type 'number'.");if(null===e)return void this._set("max",null);var i=this.toPrecision(e);if(r!==i){if(s.isSome(o)&&i<=o)return void this._logError("slider:invalid-value","Property 'max' must be greater than 'min'.");if(this._set("max",i),n&&n.length)for(var a=0;a<n.length;a++)i<n[a]&&this.setValue(a,i)}},t.prototype.setMin=function(e){var t=this,r=t.max,o=t.min,n=t.values;if(isNaN(e))return void this._logError("slider:invalid-value","Property 'min' must of type 'number'.");if(null===e)return void this._set("min",null);var i=this.toPrecision(e);if(o!==i){if(s.isSome(r)&&i>=r)return void this._logError("slider:invalid-value","Property 'min' must be less than 'max'.");if(this._set("min",i),n&&n.length)for(var a=0;a<n.length;a++)i>n[a]&&this.setValue(a,i)}},t.prototype.setValue=function(e,t){var r=this.values,o=r[e],n=this.toPrecision(t);if(o!==n){var i=this.getBoundsForValueAtIndex(e),a=i.min,s=i.max;if(n<a||n>s)return void this._logError("slider:invalid-value","Members of property 'values' must be within range.");var u=r.slice();u[e]=n,this._set("values",u),this.notifyChange("labels")}},t.prototype._logError=function(e,t,r){l.error(new i(e,t,r))},o([u.property()],t.prototype,"labelFormatFunction",null),o([u.property()],t.prototype,"inputFormatFunction",null),o([u.property()],t.prototype,"inputParseFunction",null),o([u.property({dependsOn:["labelFormatFunction","max","min","values"],readOnly:!0})],t.prototype,"labels",null),o([u.property()],t.prototype,"max",null),o([u.property()],t.prototype,"min",null),o([u.property()],t.prototype,"precision",void 0),o([u.property({dependsOn:["max","min"],readOnly:!0})],t.prototype,"state",null),o([u.property()],t.prototype,"thumbsConstrained",void 0),o([u.property()],t.prototype,"values",null),t=o([u.subclass("esri.widgets.Slider.SliderViewModel")],t)}(u.declared(n))});